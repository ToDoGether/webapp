<div class="margin">
  <% if current_user.teams.size == 0 && current_user.tasks.size == 0 %>
    <div class="welcome">
      <p class="title">Welcome! 👋🏼</p>
      <p class="paragraph">Thank you for using ToDoGether. For getting started you can either create a new team or subscribe to an already existing team.</p>
      <p class="paragraph">For further information about the application please check out our site on <%= link_to "portfolio.fh-salzburg.ac.at", "https://portfolio.fh-salzburg.ac.at/projects/2021-todogether" %>.</p>
      <%= render "teams/subscribe" %>
      <%= label_tag "Create a Team" %>
      <%= link_to "Create", new_team_path, id: "create-team", class: "btn hoverable block" %>
    </div>
  <% else %>
    <div id="search-bar">
      <%= form_tag 'tasks', method: "get", id: "form-subscribe" do %>
        <%= text_field_tag :fulltext, session[:fulltext], class: "small-padding", placeholder: "Search Tasks ..." %>
        <div>
          <%= submit_tag("", class: "btn search") %>
        </div>
        <div>
          <%= link_to "/filter", class: "btn filter" do end %>
        </div>
      <% end %>
    </div>
    <% if @user_tasks.size == 0 %>
      <% if !current_user.tasks.filter_by_status(nil).any? %>
        <div class="pad celebrate">
          <p class="emojis">🥳🎉</p>
          <p class="text">Time to celebrate ...</p>
          <p class="emojis">😎🌴</p>
          <p class="text">... or time to relax!</p>
          <p class="emojis">✅✅✅</p>
          <p class="text">You're done with all your tasks!</p>
        </div>
      <% else %>
        <p>Filter didn't find any entries.</p>
        <%= link_to "Clear Filter", "/filter-reset", class: "btn hoverable" %>
      <% end %>
    <% end %>
  <% end %>
</div>

<% @page_title = "Tasks" %>

<% @user_tasks.each do |user_task|
  task = user_task.task
  status_prev = user_task.status_name(user_task.status_prev)
  status_current = user_task.status_name
  status_next = user_task.status_name(user_task.status_next)
  %>
<div class="task">
  <%= link_to '/change_status/' + user_task.id.to_s + "/prev", class: "btn slide left " + status_prev do end %>
  <section class="task-content <%= status_current %>">
    <%= link_to task do %>
      <div class="top">
        <div style="color: <%= task.subject.color %>" class="subject"><%= task.subject.name %></div>
        <button class="btn status <%= status_current %>"><%= status_current %></button>
      </div>
      <h4><%= task.name %></h4>
      <div class="bottom">
        <div class="icons">
          <% if(task.weblinks.count > 0) %>
            <%= image_tag("icons/icon-weblink.svg", alt: "Weblink(s) available") %>
          <% end %>
          <% if(task.is_groupwork) %>
            <%= image_tag("icons/icon-group.svg", alt: "Working in a group") %>
          <% end %>
          <% if(task.attachments.count > 0) %>
            <%= image_tag("icons/icon-attachment.svg", alt: "Attachment(s) available") %>
          <% end %>
        </div>
        <div class="duedate"><%= task.formatted_duedate %></div>
      </div>
    <% end %>
  </section>
  <%= link_to '/change_status/' + user_task.id.to_s + "/next", class: "btn slide right " + status_next do end %>
</div>
<% end %>
